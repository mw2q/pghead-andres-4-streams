BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%almond%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 268571234.399155
 ALGERIA                   |   1997 | 453060266.613571
 ALGERIA                   |   1996 | 457110405.233501
 ALGERIA                   |   1995 | 459237389.997623
 ALGERIA                   |   1994 | 449679145.594513
 ALGERIA                   |   1993 | 459937205.571574
 ALGERIA                   |   1992 | 451639115.949812
 ARGENTINA                 |   1998 | 274836895.482022
 ARGENTINA                 |   1997 | 470911577.597108
 ARGENTINA                 |   1996 | 473122067.131359
 ARGENTINA                 |   1995 | 466573561.542511
 ARGENTINA                 |   1994 | 472066676.640656
 ARGENTINA                 |   1993 | 476495595.297616
 ARGENTINA                 |   1992 | 472969031.089823
 BRAZIL                    |   1998 | 272769522.191621
 BRAZIL                    |   1997 | 467140374.165391
 BRAZIL                    |   1996 | 451373584.208327
 BRAZIL                    |   1995 |  461167853.24225
 BRAZIL                    |   1994 | 461491196.952892
 BRAZIL                    |   1993 | 458173666.619833
 BRAZIL                    |   1992 | 462486020.649323
 CANADA                    |   1998 | 285587188.413618
 CANADA                    |   1997 | 484445372.997152
 CANADA                    |   1996 | 473751399.740074
 CANADA                    |   1995 | 468477347.392207
 CANADA                    |   1994 | 473720867.210331
 CANADA                    |   1993 | 474798756.987545
 CANADA                    |   1992 | 473861204.054908
 CHINA                     |   1998 | 273783349.398231
 CHINA                     |   1997 | 450139662.208947
 CHINA                     |   1996 | 454197643.183561
 CHINA                     |   1995 | 463177927.249104
 CHINA                     |   1994 |  459419811.81572
 CHINA                     |   1993 | 463512139.106838
 CHINA                     |   1992 | 463481584.581458
 EGYPT                     |   1998 | 271330625.827488
 EGYPT                     |   1997 | 464281319.909971
 EGYPT                     |   1996 | 466273193.560554
 EGYPT                     |   1995 | 468899532.137277
 EGYPT                     |   1994 | 466711979.154844
 EGYPT                     |   1993 | 458546266.478616
 EGYPT                     |   1992 | 462984010.826149
 ETHIOPIA                  |   1998 | 267119190.930846
 ETHIOPIA                  |   1997 | 457904879.862792
 ETHIOPIA                  |   1996 | 455781140.966839
 ETHIOPIA                  |   1995 | 454495403.700504
 ETHIOPIA                  |   1994 | 460241706.088078
 ETHIOPIA                  |   1993 | 463089521.293528
 ETHIOPIA                  |   1992 | 459043138.173362
 FRANCE                    |   1998 | 269511323.573825
 FRANCE                    |   1997 | 451990189.078657
 FRANCE                    |   1996 | 458370308.398815
 FRANCE                    |   1995 | 453429342.588884
 FRANCE                    |   1994 | 454414917.360735
 FRANCE                    |   1993 |  450409555.02365
 FRANCE                    |   1992 | 453650492.854015
 GERMANY                   |   1998 | 279228183.761546
 GERMANY                   |   1997 | 492733178.219116
 GERMANY                   |   1996 |  484043421.39965
 GERMANY                   |   1995 |  481501021.88055
 GERMANY                   |   1994 | 480869447.800294
 GERMANY                   |   1993 | 483095598.058979
 GERMANY                   |   1992 | 481012657.168444
 INDIA                     |   1998 | 272024422.276388
 INDIA                     |   1997 | 472188033.175495
 INDIA                     |   1996 | 473948905.543909
 INDIA                     |   1995 | 464776610.773442
 INDIA                     |   1994 | 472793372.130973
 INDIA                     |   1993 | 472954136.008693
 INDIA                     |   1992 | 466643149.933568
 INDONESIA                 |   1998 |  266271005.69927
 INDONESIA                 |   1997 | 462124664.847032
 INDONESIA                 |   1996 | 458617186.114445
 INDONESIA                 |   1995 | 463498226.043461
 INDONESIA                 |   1994 | 456588145.388333
 INDONESIA                 |   1993 | 463639399.268913
 INDONESIA                 |   1992 | 469662341.146363
 IRAN                      |   1998 | 270202411.504955
 IRAN                      |   1997 |  468119782.70254
 IRAN                      |   1996 | 467690242.479335
 IRAN                      |   1995 | 467990802.553532
 IRAN                      |   1994 | 469620444.148136
 IRAN                      |   1993 |  466041579.77929
 IRAN                      |   1992 | 468473395.607492
 IRAQ                      |   1998 | 274367782.666458
 IRAQ                      |   1997 | 478671550.689906
 IRAQ                      |   1996 | 469887537.172548
 IRAQ                      |   1995 | 472211805.239893
 IRAQ                      |   1994 | 474415416.171372
 IRAQ                      |   1993 | 476886989.806841
 IRAQ                      |   1992 | 471960451.505689
 JAPAN                     |   1998 | 269661012.666789
 JAPAN                     |   1997 | 467684170.195482
 JAPAN                     |   1996 | 461846570.859383
 JAPAN                     |   1995 | 466055097.778579
 JAPAN                     |   1994 | 463771005.933207
 JAPAN                     |   1993 | 461617384.646836
 JAPAN                     |   1992 | 464603842.823797
 JORDAN                    |   1998 | 273741528.602142
 JORDAN                    |   1997 | 462056343.692522
 JORDAN                    |   1996 | 461204661.092285
 JORDAN                    |   1995 | 465495505.551971
 JORDAN                    |   1994 | 462175444.862072
 JORDAN                    |   1993 | 466162128.797332
 JORDAN                    |   1992 | 452423399.760738
 KENYA                     |   1998 |  270820867.52989
 KENYA                     |   1997 | 465973757.466979
 KENYA                     |   1996 | 470453346.393924
 KENYA                     |   1995 | 461876774.477959
 KENYA                     |   1994 | 463868441.447038
 KENYA                     |   1993 | 463973222.418576
 KENYA                     |   1992 | 472244755.520549
 MOROCCO                   |   1998 | 271155006.441609
 MOROCCO                   |   1997 | 470756469.514362
 MOROCCO                   |   1996 | 467064561.344321
 MOROCCO                   |   1995 | 469020752.576186
 MOROCCO                   |   1994 | 460825804.892372
 MOROCCO                   |   1993 | 465554837.215972
 MOROCCO                   |   1992 | 472710324.833214
 MOZAMBIQUE                |   1998 | 264297320.465786
 MOZAMBIQUE                |   1997 | 456772512.377832
 MOZAMBIQUE                |   1996 | 448477295.887992
 MOZAMBIQUE                |   1995 | 464431063.963065
 MOZAMBIQUE                |   1994 | 454332393.293685
 MOZAMBIQUE                |   1993 | 455359728.678957
 MOZAMBIQUE                |   1992 | 451969721.166276
 PERU                      |   1998 | 280248759.366427
 PERU                      |   1997 | 463439361.996126
 PERU                      |   1996 | 474647620.445875
 PERU                      |   1995 | 475669556.713914
 PERU                      |   1994 | 464606706.275933
 PERU                      |   1993 | 467983091.556133
 PERU                      |   1992 |   483927947.1644
 ROMANIA                   |   1998 | 273268137.186045
 ROMANIA                   |   1997 | 468080748.487224
 ROMANIA                   |   1996 | 471085496.643079
 ROMANIA                   |   1995 | 459803343.702083
 ROMANIA                   |   1994 | 468234599.294313
 ROMANIA                   |   1993 | 469636194.757817
 ROMANIA                   |   1992 | 470472051.641752
 RUSSIA                    |   1998 | 271457339.846706
 RUSSIA                    |   1997 | 465743219.293047
 RUSSIA                    |   1996 | 466047381.971014
 RUSSIA                    |   1995 | 463183829.105816
 RUSSIA                    |   1994 | 466249297.810554
 RUSSIA                    |   1993 | 464938243.350378
 RUSSIA                    |   1992 | 468233340.305742
 SAUDI ARABIA              |   1998 | 271966518.849315
 SAUDI ARABIA              |   1997 | 472837440.994042
 SAUDI ARABIA              |   1996 | 466768634.984851
 SAUDI ARABIA              |   1995 | 471964714.823059
 SAUDI ARABIA              |   1994 | 473810638.533929
 SAUDI ARABIA              |   1993 | 477148601.479763
 SAUDI ARABIA              |   1992 | 473136059.812567
 UNITED KINGDOM            |   1998 | 272102764.731777
 UNITED KINGDOM            |   1997 | 462569712.410459
 UNITED KINGDOM            |   1996 | 461128728.864893
 UNITED KINGDOM            |   1995 | 457235611.606241
 UNITED KINGDOM            |   1994 | 459933316.638384
 UNITED KINGDOM            |   1993 | 458216228.696326
 UNITED KINGDOM            |   1992 |  468554636.24199
 UNITED STATES             |   1998 | 274535525.083714
 UNITED STATES             |   1997 | 480792307.644458
 UNITED STATES             |   1996 |  480930947.36591
 UNITED STATES             |   1995 | 476238521.668981
 UNITED STATES             |   1994 | 479511570.184351
 UNITED STATES             |   1993 | 483389146.946211
 UNITED STATES             |   1992 | 479643769.102208
 VIETNAM                   |   1998 | 267040920.580469
 VIETNAM                   |   1997 | 458830847.254216
 VIETNAM                   |   1996 | 464291229.234271
 VIETNAM                   |   1995 | 461003347.680169
 VIETNAM                   |   1994 | 462397418.798075
 VIETNAM                   |   1993 |  458488493.39322
 VIETNAM                   |   1992 | 467015324.196322
(175 rows)

COMMIT;
COMMIT
